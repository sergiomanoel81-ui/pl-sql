-- Contar procedimentos que PODEM ser deletados (SEM bloqueio)
SELECT 
    COUNT(*) as QTD_PROCEDIMENTOS_DELETAR,
    COUNT(DISTINCT pp.NR_ATENDIMENTO) as QTD_ATENDIMENTOS,
    COUNT(DISTINCT pp.NR_INTERNO_CONTA) as QTD_CONTAS
FROM PROCEDIMENTO_PACIENTE pp
WHERE pp.NR_SEQ_PROC_INTERNO <> 13188
  AND pp.DT_PROCEDIMENTO > '01/10/25 00:00:01' 
  AND OBTER_ESTAB_ATENDIMENTO(pp.NR_ATENDIMENTO) = 3
  AND NOT EXISTS (
      SELECT 1 
      FROM CONTA_PACIENTE cp 
      WHERE cp.NR_INTERNO_CONTA = pp.NR_INTERNO_CONTA
        AND cp.IE_STATUS_ACERTO <> 2
  );
  
  
  DELETE FROM PROCEDIMENTO_PACIENTE pp
WHERE pp.NR_SEQ_PROC_INTERNO <> 11515
  AND pp.DT_PROCEDIMENTO > '01/10/25 00:00:01' 
  AND OBTER_ESTAB_ATENDIMENTO(pp.NR_ATENDIMENTO) = 3
  AND NOT EXISTS (
      SELECT 1 
      FROM CONTA_PACIENTE cp 
      WHERE cp.NR_INTERNO_CONTA = pp.NR_INTERNO_CONTA
        AND cp.IE_STATUS_ACERTO = 2  -- Exclui contas com status 2
  );
